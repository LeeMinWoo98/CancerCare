<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6대암 식단 추천 - CancerCare</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    
    <!-- 폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- CSS 파일들 -->
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/food.css}">
    <link rel="stylesheet" th:href="@{/css/recommend.css}">
</head>
<body>
    <!-- 헤더 포함 -->
    <div th:replace="~{fragments/header :: headerFragment}"></div>

    <div class="page-container">
        <h1 class="page-title">
            <i class="fas fa-utensils" style="color: #667eea;"></i>
            6대암 식단 추천
        </h1>
        <p class="page-subtitle">개인 맞춤형 식단을 추천받아보세요</p>

        <!-- 식단 추천 요청 폼 -->
        <div class="form-card">
            <h2 class="form-title">
                <i class="fas fa-clipboard-list"></i>
                식단 추천 요청
            </h2>
            <form id="recommendForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="cancerType" class="form-label">
                            <i class="fas fa-stethoscope"></i> 암 종류
                        </label>
                        <select class="form-select" id="cancerType" name="cancer_type" required>
                            <option value="">암 종류를 선택해주세요</option>
                            <option value="stomach" th:selected="${userInfo != null and userInfo.cancerType == 'stomach'}">위암</option>
                            <option value="colon" th:selected="${userInfo != null and userInfo.cancerType == 'colon'}">대장암</option>
                            <option value="breast" th:selected="${userInfo != null and userInfo.cancerType == 'breast'}">유방암</option>
                            <option value="cervical" th:selected="${userInfo != null and userInfo.cancerType == 'cervical'}">자궁경부암</option>
                            <option value="liver" th:selected="${userInfo != null and userInfo.cancerType == 'liver'}">간암</option>
                            <option value="lung" th:selected="${userInfo != null and userInfo.cancerType == 'lung'}">폐암</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="stage" class="form-label">
                            <i class="fas fa-layer-group"></i> 병기
                        </label>
                        <select class="form-select" id="stage" name="stage" required>
                            <option value="">병기를 선택해주세요</option>
                            <option value="1" th:selected="${userInfo != null and userInfo.stage == '1'}">1기</option>
                            <option value="2" th:selected="${userInfo != null and userInfo.stage == '2'}">2기</option>
                            <option value="3" th:selected="${userInfo != null and userInfo.stage == '3'}">3기</option>
                            <option value="4" th:selected="${userInfo != null and userInfo.stage == '4'}">4기</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="age" class="form-label">
                            <i class="fas fa-birthday-cake"></i> 나이
                        </label>
                        <input type="number" class="form-input" id="age" name="age" 
                               th:value="${userInfo != null ? userInfo.age : ''}"
                               placeholder="예: 30" min="1" max="120" required>
                    </div>

                    <div class="form-group">
                        <label for="sex" class="form-label">
                            <i class="fas fa-venus-mars"></i> 성별
                        </label>
                        <select class="form-select" id="sex" name="sex" required>
                            <option value="">성별을 선택해주세요</option>
                            <option value="male" th:selected="${userInfo != null and userInfo.gender == 'male'}">남성</option>
                            <option value="female" th:selected="${userInfo != null and userInfo.gender == 'female'}">여성</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="height" class="form-label">
                            <i class="fas fa-ruler-vertical"></i> 키 (cm)
                        </label>
                        <input type="number" class="form-input" id="height" name="height_cm" 
                               th:value="${userInfo != null ? userInfo.height : ''}"
                               placeholder="예: 175" min="100" max="250" required>
                    </div>

                    <div class="form-group">
                        <label for="weight" class="form-label">
                            <i class="fas fa-weight"></i> 몸무게 (kg)
                        </label>
                        <input type="number" class="form-input" id="weight" name="weight_kg" 
                               th:value="${userInfo != null ? userInfo.weight : ''}"
                               placeholder="예: 70" min="30" max="200" required>
                    </div>

                    <div class="form-group allergies-section">
                        <label class="form-label">
                            <i class="fas fa-exclamation-triangle"></i> 알레르기 (해당사항 선택)
                        </label>
                        <div class="allergies-grid">
                            <label class="allergy-item">
                                <input type="checkbox" name="allergies" value="peanut">
                                <span>땅콩</span>
                            </label>
                            <label class="allergy-item">
                                <input type="checkbox" name="allergies" value="seafood">
                                <span>해산물</span>
                            </label>
                            <label class="allergy-item">
                                <input type="checkbox" name="allergies" value="milk">
                                <span>우유</span>
                            </label>
                            <label class="allergy-item">
                                <input type="checkbox" name="allergies" value="egg">
                                <span>계란</span>
                            </label>
                            <label class="allergy-item">
                                <input type="checkbox" name="allergies" value="soy">
                                <span>콩</span>
                            </label>
                            <label class="allergy-item">
                                <input type="checkbox" name="allergies" value="wheat">
                                <span>밀</span>
                            </label>
                            <label class="allergy-item">
                                <input type="checkbox" name="allergies" value="other" id="allergyOther">
                                <span>기타</span>
                            </label>
                        </div>
                        <div class="other-input-container" id="allergyOtherContainer" style="display: none;">
                            <input type="text" class="form-input" id="allergyOtherText" name="allergy_other" 
                                   placeholder="기타 알레르기를 입력해주세요">
                        </div>
                    </div>

                    <div class="form-group symptoms-section">
                        <label class="form-label">
                            <i class="fas fa-notes-medical"></i> 증상 (해당사항 선택)
                        </label>
                        <div class="symptoms-grid">
                            <label class="symptom-item">
                                <input type="checkbox" name="symptoms" value="식욕부진">
                                <span>식욕부진</span>
                            </label>
                            <label class="symptom-item">
                                <input type="checkbox" name="symptoms" value="설사">
                                <span>설사</span>
                            </label>
                            <label class="symptom-item">
                                <input type="checkbox" name="symptoms" value="변비">
                                <span>변비</span>
                            </label>
                            <label class="symptom-item">
                                <input type="checkbox" name="symptoms" value="구토">
                                <span>구토</span>
                            </label>
                            <label class="symptom-item">
                                <input type="checkbox" name="symptoms" value="메스꺼움">
                                <span>메스꺼움</span>
                            </label>
                            <label class="symptom-item">
                                <input type="checkbox" name="symptoms" value="체중감소">
                                <span>체중감소</span>
                            </label>
                            <label class="symptom-item">
                                <input type="checkbox" name="symptoms" value="other" id="symptomOther">
                                <span>기타</span>
                            </label>
                        </div>
                        <div class="other-input-container" id="symptomOtherContainer" style="display: none;">
                            <input type="text" class="form-input" id="symptomOtherText" name="symptom_other" 
                                   placeholder="기타 증상을 입력해주세요">
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn-recommend" id="submitBtn">
                    <i class="fas fa-magic"></i>
                    맞춤 식단 추천받기
                </button>
            </form>
        </div>

        <!-- 결과 섹션 -->
        <div class="result-section" id="resultSection">
            <h2 class="result-title">
                <i class="fas fa-star"></i>
                추천 식단
            </h2>
            
            <div class="loading" id="loadingDiv">
                <div class="spinner"></div>
                <div>맞춤 식단을 준비하고 있습니다...</div>
            </div>

            <div id="resultContent" style="display: none;">
                <!-- 영양 정보 요약 -->
                <div class="nutrition-summary">
                    <div class="nutrition-grid">
                        <div class="nutrition-item">
                            <span class="nutrition-value" id="totalKcal">-</span>
                            <div class="nutrition-label">총 칼로리</div>
                        </div>
                        <div class="nutrition-item">
                            <span class="nutrition-value" id="targetKcal">-</span>
                            <div class="nutrition-label">목표 칼로리</div>
                        </div>
                        <div class="nutrition-item">
                            <span class="nutrition-value" id="proteinEst">-</span>
                            <div class="nutrition-label">단백질 (g)</div>
                        </div>
                        <div class="nutrition-item">
                            <span class="nutrition-value" id="sodiumLevel">-</span>
                            <div class="nutrition-label">나트륨 수준</div>
                        </div>
                    </div>
                </div>

                <!-- 메뉴 구성 -->
                <div class="menu-section">
                    <div class="menu-category-title">
                        <i class="fas fa-bowl-rice"></i> 주식
                    </div>
                    <div class="menu-item" id="riceMenu">
                        <span class="menu-item-name">-</span>
                        <span class="menu-item-kcal">- kcal</span>
                    </div>
                </div>

                <div class="menu-section">
                    <div class="menu-category-title">
                        <i class="fas fa-soup"></i> 국물
                    </div>
                    <div class="menu-item" id="soupMenu">
                        <span class="menu-item-name">-</span>
                        <span class="menu-item-kcal">- kcal</span>
                    </div>
                </div>

                <div class="menu-section">
                    <div class="menu-category-title">
                        <i class="fas fa-fish"></i> 반찬
                    </div>
                    <div id="sidesMenu">
                        <!-- 반찬들이 동적으로 추가됩니다 -->
                    </div>
                </div>

                <div class="menu-section">
                    <div class="menu-category-title">
                        <i class="fas fa-apple-alt"></i> 간식
                    </div>
                    <div class="menu-item" id="snackMenu">
                        <span class="menu-item-name">-</span>
                        <span class="menu-item-kcal">- kcal</span>
                    </div>
                </div>

                <!-- 추천 이유 -->
                <div class="reasoning-section">
                    <div class="reasoning-title">
                        <i class="fas fa-lightbulb"></i> 추천 이유
                    </div>
                    <ul class="reasoning-list" id="reasoningList">
                        <!-- 추천 이유들이 동적으로 추가됩니다 -->
                    </ul>
                </div>

                <!-- 주의사항 -->
                <div class="warnings-section" id="warningsSection" style="display: none;">
                    <div class="warnings-title">
                        <i class="fas fa-exclamation-triangle"></i> 주의사항
                    </div>
                    <ul class="warnings-list" id="warningsList">
                        <!-- 주의사항들이 동적으로 추가됩니다 -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script th:src="@{/js/recommend.js}"></script>
</body>
</html>
