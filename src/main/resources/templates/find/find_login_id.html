<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>cancercare – 아이디 찾기</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{
            --bg:#f7f9fc;
            --card:#ffffff;
            --text:#0b1a2b;
            --muted:#6b7280;
            --brand:#2563eb; /* blue-600 */
            --brand-700:#1d4ed8;
            --outline:#e5e7eb;
            --shadow:0 10px 30px rgba(2, 17, 79, .08);
            --radius:16px;
        }
        *{box-sizing:border-box}
        html,body{height:100%}
        body{margin:0;background:var(--bg);font-family:"Pretendard", system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;color:var(--text)}
        .wrap{min-height:100%;display:grid;place-items:center;padding:40px 16px}

        .card{width:100%;max-width:420px;background:var(--card);border:1px solid var(--outline);border-radius:var(--radius);box-shadow:var(--shadow);padding:28px}
        .brand{display:flex;align-items:center;gap:10px;margin-bottom:6px}
        .logo{width:28px;height:28px;border-radius:50%;display:grid;place-items:center;background:linear-gradient(135deg,#4f46e5,#22d3ee);color:#fff;font-size:14px;font-weight:800}
        .subtitle{color:var(--muted);font-size:13px;margin-top:4px}

        h1{margin:10px 0 2px;font-size:24px;letter-spacing:-.01em}

        form{margin-top:18px}
        .field{margin-bottom:14px}
        label{display:block;font-weight:600;margin-bottom:8px}
        .req{color:#ef4444;margin-left:4px}
        input[type=email]{width:100%;height:44px;border:1px solid var(--outline);border-radius:10px;padding:0 12px;font-size:15px;outline:none;background:#fff}
        input[type=email]::placeholder{color:#9ca3af}
        input[type=email]:focus{border-color:#94b5ff;box-shadow:0 0 0 3px rgba(37,99,235,.12)}

        .btn{width:100%;height:46px;border:none;border-radius:12px;background:var(--brand);color:#fff;font-weight:700;font-size:15px;cursor:pointer;margin-top:14px}
        .btn:hover{background:var(--brand-700)}
        .btn:disabled{background:#9ca3af;cursor:not-allowed}

        .result{margin-top:20px;padding:16px;border-radius:10px;font-size:14px;line-height:1.5;display:none}
        .result.success{background:#f0f9ff;border:1px solid #bae6fd;color:#0369a1}
        .result.error{background:#fef2f2;border:1px solid #fecaca;color:#991b1b}

        .found-id{font-size:18px;font-weight:600;color:#0369a1;margin:10px 0;text-align:center;letter-spacing:2px}

        .back-link{display:inline-flex;align-items:center;gap:6px;color:#2563eb;text-decoration:none;font-size:14px;margin-top:20px}
        .back-link:hover{text-decoration:underline}

        .alert{margin-top:12px;border:1px solid #fecaca;background:#fef2f2;color:#991b1b;border-radius:10px;padding:10px 12px;font-size:14px}
    </style>
</head>
<body>
<div class="wrap">
    <div class="card">
        <!-- 로고 / 브랜드 -->
        <div class="brand">
            <div class="logo">A</div>
            <strong>cancercare</strong>
        </div>

        <!-- 타이틀 -->
        <h2>아이디 찾기</h2>
        <div class="subtitle">가입 시 사용한 이메일을 입력해주세요</div>

        <!-- 아이디 찾기 폼 -->
        <form id="findIdForm">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <div class="field">
                <label for="email">이메일 <span class="req">*</span></label>
                <input id="email" name="email" type="email" placeholder="이메일을 입력하세요" required>
            </div>

            <button class="btn" type="submit" id="findBtn">아이디 찾기</button>
        </form>

        <!-- 결과 표시 영역 -->
        <div id="result" class="result">
            <div id="resultMessage"></div>
            <div id="foundId" class="found-id" style="display:none"></div>
        </div>

        <!-- 뒤로가기 링크 -->
        <a th:href="@{/find}" class="back-link">
            ← 찾기 메뉴로 돌아가기
        </a>
    </div>
</div>

<script th:inline="javascript">
const csrfToken = /*[[${_csrf.token}]]*/ '';
const csrfHeader = /*[[${_csrf.headerName}]]*/ '';

document.getElementById('findIdForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const email = document.getElementById('email').value;
    const findBtn = document.getElementById('findBtn');
    const result = document.getElementById('result');
    const resultMessage = document.getElementById('resultMessage');
    const foundId = document.getElementById('foundId');
    
    if (!email) {
        showResult('error', '이메일을 입력해주세요.');
        return;
    }
    
    findBtn.disabled = true;
    findBtn.textContent = '찾는 중...';
    
    try {
        const formData = new FormData();
        formData.append('email', email);
        formData.append('_csrf', csrfToken);
        
        const response = await fetch('/find/login_id', {
            method: 'POST',
            headers: {
                [csrfHeader]: csrfToken
            },
            body: formData
        });
        
        const data = await response.text();
        
        if (data.startsWith('success:')) {
            const loginId = data.substring(8); // "success:" 제거
            showResult('success', '등록된 아이디를 찾았습니다.');
            foundId.textContent = `${loginId}`;
            foundId.style.display = 'block';
        } else {
            showResult('error', data);
            foundId.style.display = 'none';
        }
    } catch (error) {
        showResult('error', '서버 오류가 발생했습니다.');
        foundId.style.display = 'none';
    } finally {
        findBtn.disabled = false;
        findBtn.textContent = '아이디 찾기';
    }
});

function showResult(type, message) {
    const result = document.getElementById('result');
    const resultMessage = document.getElementById('resultMessage');
    
    result.className = `result ${type}`;
    result.style.display = 'block';
    resultMessage.textContent = message;
}
</script>
</body>
</html>
