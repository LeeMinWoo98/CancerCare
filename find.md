# 아이디 찾기 & 비밀번호 재설정 기능 명세서

## 📋 개요
CancerCare 웹 애플리케이션에 아이디 찾기 및 비밀번호 재설정 기능을 추가하여 사용자 편의성을 향상시킵니다.

---

## 🎯 1. 목표 및 범위

### 1.1 아이디 찾기
- **목표**: 사용자가 이메일을 입력하면 해당 이메일에 매핑된 로그인 아이디를 화면에 표시
- **보안**: 마스킹된 아이디만 노출 (예: `jo***doe`)

### 1.2 비밀번호 재설정
- **목표**: 이메일 인증을 통한 안전한 비밀번호 재설정
- **플로우**: 이메일 입력 → 인증코드 발송 → 인증코드 검증 → 새 비밀번호 설정 → 강제 재로그인

---

## 🔄 2. 화면 플로우

### 2.1 아이디 찾기 플로우

```
사용자 입력: 이메일 주소
        ↓
   "아이디 찾기" 클릭
        ↓
서버: 이메일 존재 확인
        ↓
┌─────────────────┬─────────────────┐
│   이메일 일치    │   이메일 불일치   │
│                │                │
│ 마스킹된 아이디   │ "가입되지 않은    │
│ 화면에 표시      │  이메일입니다"   │
│ (예: jo***doe)  │     오류 메시지   │
└─────────────────┴─────────────────┘
```

### 2.2 비밀번호 재설정 플로우

```
사용자 입력: 이메일 주소
        ↓
  "인증코드 발송" 클릭
        ↓
서버: 6자리 인증코드 생성 및 이메일 발송
     (만료시간: 5분, 최대시도: 5회)
        ↓
화면: 타이머와 함께 인증코드 입력 폼 표시
        ↓
사용자: 인증코드 입력 → "확인" 클릭
        ↓
서버: 인증코드 검증
        ↓
┌─────────────────┬─────────────────┐
│   코드 일치      │   코드 불일치    │
│                │                │
│ 비밀번호 변경    │ "인증번호가      │
│ 폼 화면 이동     │  일치하지 않습니다" │
│                │    오류 메시지    │
└─────────────────┴─────────────────┘
        ↓ (코드 일치시)
사용자: 새 비밀번호 입력 및 확인
        ↓
  "비밀번호 변경" 클릭
        ↓
서버: 비밀번호 변경 (BCrypt 암호화)
     인증코드 무효화
     기존 세션 무효화
        ↓
화면: "비밀번호가 변경되었습니다. 다시 로그인하세요."
     → 로그인 페이지로 이동
```

---

## 🛠️ 3. 기술 구현 요구사항

### 3.1 공통 요구사항
- **이메일 검증**: 기존 회원가입과 동일한 이메일 형식 검증
- **보안**: CSRF 토큰 적용
- **UI/UX**: 기존 디자인과 일관성 유지 (민트색 테마)

### 3.2 아이디 찾기
- **엔드포인트**: `POST /find/login_id`
- **입력**: 이메일 주소
- **출력**: 마스킹된 아이디 또는 오류 메시지
- **마스킹 규칙**: 
  - 4글자 이하: 첫 글자만 표시 (`j***`)
  - 5글자 이상: 첫 2글자와 마지막 1글자 표시 (`jo***e`)

### 3.3 비밀번호 재설정
- **인증코드 발송**: `POST /find/password/send-code`
- **인증코드 검증**: `POST /find/password/verify-code`
- **비밀번호 변경**: `POST /find/password/reset`

### 3.4 인증코드 시스템
- **코드 형식**: 6자리 숫자
- **만료시간**: 5분
- **최대 시도횟수**: 5회
- **재발송**: 기존 코드 무효화 후 새 코드 생성
- **저장소**: 기존 `email_verification_codes` 테이블 활용

### 3.5 보안 요구사항
- **비밀번호 암호화**: BCrypt 해싱
- **세션 무효화**: 비밀번호 변경 후 모든 기존 세션 만료
- **인증코드 보안**: 검증 완료 후 즉시 무효화
- **브루트포스 방지**: 시도횟수 제한 및 시간 기반 제한

---

## 📄 4. 화면 설계

### 4.1 아이디/비밀번호 찾기 선택 페이지
- **URL**: `/find`
- **구성요소**:
  - 아이디 찾기 버튼
  - 비밀번호 재설정 버튼
  - 로그인 페이지로 돌아가기 링크

### 4.2 아이디 찾기 페이지
- **URL**: `/find/login_id`
- **구성요소**:
  - 이메일 입력 필드
  - "아이디 찾기" 버튼
  - 결과 표시 영역 (마스킹된 아이디 또는 오류 메시지)

### 4.3 비밀번호 재설정 페이지
- **URL**: `/find/password`
- **구성요소**:
  - 단계별 진행 표시
  - 이메일 입력 → 인증코드 입력 → 새 비밀번호 설정
  - 실시간 타이머 (5분 카운트다운)
  - 인증코드 재발송 버튼

---

## 📧 5. 이메일 템플릿

### 5.1 비밀번호 재설정 인증코드 이메일
- **제목**: "[CancerCare] 비밀번호 재설정 인증코드"
- **발송자**: "CancerCare <noreply@cancercare.com>"
- **템플릿**: 기존 회원가입 인증 이메일과 동일한 디자인
- **내용**:
  - 비밀번호 재설정 요청 안내
  - 6자리 인증코드 (민트색 박스)
  - 5분 만료 안내
  - 보안 주의사항

---

## ✅ 6. 검증 및 테스트 계획

### 6.1 기능 테스트
- [ ] 올바른 이메일로 아이디 찾기
- [ ] 존재하지 않는 이메일로 아이디 찾기
- [ ] 인증코드 발송 및 검증
- [ ] 잘못된 인증코드 입력
- [ ] 인증코드 만료 처리
- [ ] 비밀번호 변경 및 세션 무효화

### 6.2 보안 테스트
- [ ] SQL 인젝션 방지
- [ ] CSRF 토큰 검증
- [ ] 세션 하이재킹 방지
- [ ] 브루트포스 공격 방지

### 6.3 사용성 테스트
- [ ] 반응형 디자인 확인
- [ ] 타이머 정확성 검증
- [ ] 오류 메시지 명확성
- [ ] 전체 플로우 사용자 경험

---

## 🚀 7. 구현 우선순위

1. **1단계**: 데이터베이스 및 엔티티 설정
2. **2단계**: 아이디 찾기 기능 구현
3. **3단계**: 비밀번호 재설정 - 인증코드 발송
4. **4단계**: 비밀번호 재설정 - 인증코드 검증
5. **5단계**: 비밀번호 재설정 - 새 비밀번호 설정
6. **6단계**: 프론트엔드 UI/UX 완성
7. **7단계**: 이메일 템플릿 디자인
8. **8단계**: 보안 강화 및 테스트

---

## 📝 8. 참고사항

- 기존 회원가입 이메일 인증 시스템을 최대한 재활용
- 일관된 사용자 경험을 위해 기존 디자인 시스템 준수
- 보안을 최우선으로 고려하여 구현
- 사용자 피드백을 반영할 수 있도록 유연한 구조 설계
